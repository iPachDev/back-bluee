sequenceDiagram
  autonumber
  participant Client as Cliente
  participant GW as back-bluee (API Gateway)
  participant Users as users MS
  participant DB as MongoDB

  rect rgba(220, 240, 255, 0.1)
  Note over Client,GW: Change Password
  Client->>GW: POST /auth/change-password { currentPassword, newPassword }
  GW->>GW: JwtAuthGuard.canActivate() [apps/back-bluee/src/auth/guards/jwt-auth.guard.ts]
  GW->>GW: AuthController.changePassword() [apps/back-bluee/src/auth/auth.controller.ts]
  GW->>Users: AuthService.changePassword() [apps/back-bluee/src/auth/auth.service.ts] via RMQ auth.change-password
  Users->>Users: AuthController.changePassword() [apps/users/src/auth/auth.controller.ts]
  Users->>Users: AuthService.changePassword() [apps/users/src/auth/auth.service.ts]
  Users->>DB: find user by id (+password)
  Users->>Users: bcrypt.compare(currentPassword, hash)
  Users->>DB: update password (hash via schema)
  Users->>DB: revoke refresh tokens for user
  Users->>DB: increment user.tokenVersion
  Users-->>GW: ResponseEnvelope{ok}
  GW-->>Client: Clear refresh cookie + ResponseEnvelope{ok}
  end
